<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="alexu@cloudgeometry.io" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>How to Model Your Environments - CG DevX Guide</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "How to Model Your Environments";
        var mkdocs_page_input_path = "developers_guide/workloads/gitops_environments.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/hcl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> CG DevX Guide
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">CG DevX</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../platform_engineering/">Platform Engineering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cgdevx/">Why CG DevX</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../approach/">Concept</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Capabilities</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../capabilities/capabilities/">Capabilities Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../capabilities/reference_implementation/">Reference Implementation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../capabilities/known_limitations/">Shared Responsibility</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../tools/">Acknowledgements</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Operators Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../operators_guide/concept/">Concept</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../operators_guide/supported_platforms/">Platforms and providers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Installation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../operators_guide/installation/quickstart/">Installation process</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">CLI</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/installation/installing_cli/">Installing CG DevX CLI</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/installation/building_cli/">Building CG DevX CLI</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/installation/cli_commands/">CG DevX CLI commands</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Cloud</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/installation/cloud/aws_setup/">Deploying on AWS</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/installation/cloud/azure_setup/">Deploying on Azure</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Git</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/installation/vcs/github_setup/">Using GitHub</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/installation/vcs/gitlab_setup/">Using GitLab</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Platform Management</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../operators_guide/platform_management/platform_repo/">CG DevX platform GitOps repository</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Terraform</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/platform_management/iac/vcs_management/">VCS management</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/platform_management/iac/core_infrastructure_management/">Platform infrastructure</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/platform_management/iac/secrets_management/">Secrets management</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/platform_management/iac/users_management/">User management</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/platform_management/iac/core_services/">Core platform services</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Services</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/platform_management/services/delivery/">Delivery</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/platform_management/services/integration/">Integration</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/platform_management/services/monitoring/">Monitoring</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/platform_management/services/registry/">Registry</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/platform_management/services/secrets/">Secrets Management</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../operators_guide/platform_management/services/security/">Security</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Workload Management</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../operators_guide/workload_management/workloads/">Workloads Quickstart Guide</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../operators_guide/workload_management/cli_commands/">CG DevX CLI Workload Management commands</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../operators_guide/workload_management/bootstrap_templates/">Bootstrap templates</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../operators_guide/workload_management/environments/">Workload Environments</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Delivery Pipelines</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../operators_guide/delivery_pipelines/core_services_delivery/">Delivery Pipelines</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developers Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../concept/">Concept</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Workloads</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../concept/">Workload concept</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">How to Model Your Environments</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#understanding-workload-configuration-types">Understanding Workload configuration types:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#folder-structure">Folder structure</a>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Pipelines</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../cd/delivery/">Delivery</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../cd/promotion/">Promotion</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ci/integration/">Integration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ci/argo_workflows/">Argo workflows: basic flows and templates</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ci/github_action_workflow/">Github Action Workflow Structure</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ci/build_routine/">Build routine execution</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ci/kaniko_build/">Image build: Kaniko</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ci/megalinter/">Megalinter</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ci/trivy/">Trivy</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ci/code_quality/">Code quality</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ci/devsecops/">Devsecops</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Observability</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../observability/monitoring/">Monitoring</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../observability/dashboards/">List of Dashboards</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../observability/log_management/">Log management</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Artifacts</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../artifacts/registry/">Registry</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../artifacts/registry_proxy/">Registry proxy</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Under the hood</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Architecture</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/architecture/">Under the hood</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/iam/iam/">IAM</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/network/networking/">Networking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/devsecops/devsecops/">DevSecOps</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/observability/observability/">Observability</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/runtime/runtime/">Runtime</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/delivery_pipelines/delivery_pipelines/">Delivery Pipelines</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/delivery_pipelines/argo_cleanup/">Argo workflows cleanup options</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/delivery_pipelines/argo_config/">Argo workflows configuration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/delivery_pipelines/argo_permissions/">Argo workflows permission scopes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/delivery_pipelines/atlantis/">Atlantis</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/cost_management/cost_management/">Cost Management</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../under_the_hood/workloads/workload_management/">Workload Management</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">CG DevX Guide</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Developers Guide</li>
          <li class="breadcrumb-item">Workloads</li>
      <li class="breadcrumb-item active">How to Model Your Environments</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="how-to-model-your-environments">How to Model Your Environments</h1>
<p>This is a reference implementation of a GitOps approach to environments management using Kustomize folders. The release
promotion model relies on this structure.</p>
<p>For more details, please see <a href="https://github.com/kostis-codefresh/gitops-environment-promotion">this great example</a></p>
<h2 id="understanding-workload-configuration-types">Understanding Workload configuration types:</h2>
<p>These are the most common configuration types in the context of a Kubernetes application:</p>
<ul>
<li>
<p><strong>Application version</strong> in the form of the container tag used.
  This is the most important setting from a promotion perspective.
  Often a change to the application version triggered by a source code change also requires a
  change to the runtime environment.</p>
</li>
<li>
<p><strong>Kubernetes-specific settings</strong> This includes the replica count, resource limits, health checks, persistent volumes,
  affinity rules, etc.</p>
</li>
<li>
<p>(mostly) <strong>Static business settings</strong>.
  Application settings that are unrelated to Kubernetes, such as external URLs, authentication providers, connection
  strings, etc. These are "mostly static" — settings that are defined once for each environment and then never change.
  You don't want to promote these settings between environments.</p>
</li>
<li>
<p>Non-static <strong>business settings</strong>.
  The same thing as static business settings, but you <strong>do</strong> want to promote them between environments.</p>
</li>
</ul>
<h2 id="folder-structure">Folder structure</h2>
<ul>
<li>
<p>The <code>base</code> folder holds configurations that are common to all environments.
  It is not expected to change often.
  If you want to make changes to multiple environments at the same time please use <code>variants</code>.</p>
</li>
<li>
<p>The <code>variants</code> folder holds common characteristics between environments.
  It is up to you to define those commonalities.</p>
</li>
<li>
<p>The <code>envs</code> folder holds individual environment configurations that are built from <code>base</code> and <code>variants</code>, and also
  includes
  environment-specific settings that are not common.</p>
</li>
</ul>
<p>As for business settings, both static and non-static can come from envs, ConfigMap, Secret, and ExternalSecret, and are
Workload-specific; this reference implementation should be updated according to the needs of your application.</p>
<pre><code>.
├── base # &lt;= common configuration
│   ├── deployment.yaml # &lt;= kuernetes settings
│   ├── kustomization.yaml
│   ├── service.yaml # &lt;= kuernetes settings
│   └── serviceaccount.yaml # &lt;= kuernetes settings
├── envs # &lt;= environment specific configuration
│   ├── dev
│   │   ├── cm.yaml # &lt;= business settings
│   │   ├── deployment.yaml # &lt;= kuernetes settings
│   │   ├── external-secrets.yaml # &lt;= business settings
│   │   ├── ingress.yaml # &lt;= kuernetes settings
│   │   ├── kustomization.yaml
│   │   ├── settings.yaml # &lt;= business settings
│   │   └── version.yaml # &lt;= application version 
│   ├── prod
│   │   ├── cm.yaml # &lt;= business settings
│   │   ├── deployment.yaml # &lt;= kuernetes settings
│   │   ├── external-secrets.yaml # &lt;= business settings
│   │   ├── ingress.yaml # &lt;= kuernetes settings
│   │   ├── kustomization.yaml
│   │   ├── settings.yaml # &lt;= business settings
│   │   └── version.yaml # &lt;= application version
│   └── sta
│       ├── cm.yaml # &lt;= business settings
│       ├── deployment.yaml # &lt;= kuernetes settings
│       ├── external-secrets.yaml # &lt;= business settings
│       ├── ingress.yaml # &lt;= kuernetes settings
│       ├── kustomization.yaml
│       ├── settings.yaml # &lt;= business settings
│       └── version.yaml # &lt;= application version
└── variants # &lt;= common configuration between environments
    ├── dev
    │   ├── dev.yaml # &lt;= kuernetes settings
    │   ├── kustomization.yaml
    │   ├── replicas.yaml # &lt;= kuernetes settings replicas count
    │   └── settings.yaml # &lt;= static settings
    ├── prod
    │   ├── kustomization.yaml
    │   ├── prod.yaml # &lt;= kuernetes settings
    │   ├── replicas.yaml # &lt;= kuernetes settings replicas count
    │   └── settings.yaml # &lt;= static settings
    └── uat
        ├── kustomization.yaml
        ├── replicas.yaml # &lt;= kuernetes settings replicas count
        ├── settings.yaml # &lt;= static settings
        └── uat.yaml # &lt;= other kuernetes settings

</code></pre>
<p>You can generate and compare effective manifests for each environment using the commands below:</p>
<pre><code class="language-bash"># Current directory: GITROOT/gitops/environments

# make temp dir for file comparison
mkdir .tmp

# generate effective manifest
kustomize build envs/dev/&gt; .tmp/dev.yaml
kustomize build envs/sta/ &gt; .tmp/sta.yaml
kustomize build envs/prod/ &gt; .tmp/prod.yaml

# diff envs manifests
vimdiff .tmp/dev.yaml .tmp/sta.yaml .tmp/prod.yaml

# drop temp dir
rm -rf .tmp/
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../concept/" class="btn btn-neutral float-left" title="Workload concept"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../cd/delivery/" class="btn btn-neutral float-right" title="Delivery">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../concept/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../cd/delivery/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
