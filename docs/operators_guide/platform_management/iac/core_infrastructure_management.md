# Platform infrastructure

Core infrastructure required by the platform is provisioned by cloud-provider-specific module defined
in `/terraform/hosting_provider/main.tf`.

Minimal set of parameters for the module is the following:

- **cluster_name**: K8s cluster name;
- **region**: Location of the cluster, e.g., region name for AWS, location for Azure, cloud-provider-specific;
- **alert_emails**: Email(s) that will be subscribed for alerts from cloud native monitoring;
- **cluster_ssh_public_key**: SSH key used to access K8s nodes when possible, auto generated by CLI,
  cloud-provider-specific;
- **tags**: default tags/labels applied to cloud resources, cloud-provider-specific;
- **cluster_node_labels**: default labels applied to K8s cluster nodes;
- **domain_name**: FQDN used by CC cluster;
- **workloads**: workloads definitions loaded from workloads.tfvars.json file.

Provisioning will use cloud-provider module specifics for the rest of parameters.
Defaults are set to be the most cost-efficient with respect to instance types availability and resource limits of a new
cloud account.
You should adjust defaults based on your requirements.

- **cluster_network_cidr**: K8s cluster network CIDR, defaults to `10.0.0.0/16`
- **az_count**: Number of availability zones
- **cluster_version**: K8s cluster version
- **node_groups**: array of objects representing K8s node groups
    - **name**: node group name, defaults to `default`
    - **instance_types**: A compute node type (size), will fall back to the next value when the first specified instance type is not available. Could be used in combination with capacity_type = "spot", cloud-provider-specific; 
    - **min_size**: min node count for K8s cluster;
    - **max_size**: max node count for K8s cluster; 
    - **desired_size**: desired node count for K8s cluster;
    - **capacity_type**: determines compute node capacity type, e.g. "on-demand" or "spot", defaults to "on-demand", cloud-provider-specific;

Infrastructure module uses workload definitions to manage access to shared resources.
Definitions are provided using `workloads` variable passed via `terraform.tfvars.json` file.

Below is an example of `terraform.tfvars.json` file containing one workload called `demo-workload`.

```json
{
  "workloads": {
    "demo-workload": {
      "description": "CG DevX Demo-Workload workload definition"
    }
  }
}
```